<script src="processing.min.js"></script>
<script type="text/processing" data-processing-target="mycanvas">

String[] data;
String[] colNames;
String fileName = "Data/tractData.csv";
float[] mins;
float[] maxes;
float lineWidthIncrement;
int dataLen;
float frameWidth;
float marginX;
float frameHeight;
float topMargin;
float bottomMargin;
float[][] dataPositions;
PFont f;
int fontSize;
PGraphics backBuffer;
float rectangleAnchorX;
float rectangleAnchorY;
boolean rectangleSelection;
int[] orientations;
color gradientColor1 = color(255.0,0.0,0.0);
color gradientColor2 = color(255.0,255.0,0);
boolean[] colorSelectionModes;
boolean[] dimensionSelected;
float[] topKnobHeights;
float[] bottomKnobHeights;
boolean[] togglingTop;
boolean[] togglingBottom;
boolean togglesHaveChanged;
boolean[] beingDragged;
/**
String rawData = 
"geoid,public schools,private schools,child care facilities,population,median income,assistance rate,offender density,bachelor percent!";

1400000US29001950100,2,0,0,3538,54748,0.1145311,0.00056529,0.1290323
1400000US29001950200,2,0,1,3209,17609,0.129902,0.00311624,0.1143806
1400000US29001950300,0,1,0,3138,43947,0.1260163,0.00350542,0.1657356
1400000US29001950400,2,0,1,4071,33725,0.0950725,0.0024564,0.1659813
1400000US29001950500,2,1,4,6522,25651,0.1300755,0.00521313,0.1221881
1400000US29003010100,1,0,0,5772,24485,0.0272643,0.002079,0.1575064
1400000US29003010200,3,0,4,6692,26201,0.0797292,0.00059773,0.1540194
1400000US29003010300,0,0,1,1879,39112,0.1460993,0.00159659,0.0483619
1400000US29003010400,4,0,1,2663,42881,0.0380091,0.00112655,0.1299316
1400000US29005950100,1,0,1,3290,82500,0.1218978,0.00243161,0.1556886
1400000US29005950200,2,0,2,2521,50727,0.0969203,0.00158667,0.1709309
1400000US29007950100,4,0,0,4206,15833,0.1703407,0.0021398,0.0462236
1400000US29007950200,2,1,1,5083,91250,0.0759432,0.00373795,0.05625
1400000US29007950300,0,0,0,3917,46541,0.0457053,0.00127649,0.1634531
1400000US29007950400,1,1,0,2703,41116,0.0931507,0.00369959,0.1358234
1400000US29007950500,3,0,2,3153,113458,0.0828446,0.00444022,0.0897959
1400000US29007950600,1,0,0,2935,21216,0.1019576,0.00272572,0.1403141
1400000US29007950700,2,1,2,3687,30089,0.2124756,0.00542446,0.0846906
1400000US29009960100,0,0,0,6163,42054,0.0825019,0,0.0731596
1400000US29009960200,3,0,0,7123,26292,0.1860373,0.00028078,0.0543309
1400000US29009960300,4,1,3,6601,33720,0.154595,0.00302984,0.1276844
1400000US29009960401,3,0,1,3739,39196,0.2088136,0,0.0650338
1400000US29009960402,0,0,0,3266,51818,0.2153846,0.00061237,0.0420712
1400000US29009960500,4,0,2,5727,57572,0.0960899,0.0015715,0.1054875
1400000US29009960600,0,0,0,3134,64421,0.1027496,0,0.1291716
1400000US29011960100,2,0,1,3142,30921,0.1030253,0.00222788,0.0646695
1400000US29011960200,3,0,1,4158,28902,0.1424129,0.0021645,0.0831871
1400000US29011960300,4,0,2,5334,38148,0.15281,0.00337458,0.0856638
1400000US29013070100,2,0,3,5219,28886,0.1331988,0.00076643,0.0799209
1400000US29013070200,1,0,0,4506,75197,0.1083895,0.00044385,0.1058863
1400000US29013070300,2,0,1,4513,51819,0.2689805,0.00332373,0.0462933
1400000US29013070400,3,0,1,2894,68782,0.1396161,0.00172771,0.0965092
1400000US29015460100,3,1,1,3350,40161,0.1715543,0,0.1095644
1400000US29015460200,2,0,1,2688,32531,0.1563981,0,0.045204
1400000US29015460300,1,0,1,4080,81667,0.1661255,0.00196078,0.0992318
1400000US29015460400,0,0,0,2124,40294,0.1188318,0,0.069857
1400000US29015460700,0,0,0,2649,39150,0.0605381,0,0.0526539
1400000US29015460800,0,0,0,4084,48060,0.1797015,0,0.0765136
1400000US29017950100,0,0,0,4559,50586,0.1479562,0,0.0632399
1400000US29017950200,3,0,0,4738,29038,0.2664474,0.00147742,0.041289
1400000US29017950300,1,0,0,3148,70743,0.1829856,0,0.0790179
1400000US29019000300,0,0,0,3525,64633,0.0323855,0.00056738,0.3241297
1400000US29019000600,2,1,2,4840,30653,0.0091241,0.00020661,0.2776511
1400000US29019000700,1,1,4,3983,71775,0.1456416,0.00251067,0.2317304
1400000US29019000900,2,0,4,1690,57500,0.351752,0.00532544,0.1265823
1400000US29019001001,1,0,4,3901,35963,0.0335397,0.00076903,0.2514423
1400000US29019001002,2,0,2,6363,52895,0.1200632,0.0018859,0.2360122
1400000US29019001101,0,1,4,7852,48359,0.168921,0.00038207,0.2482055
1400000US29019001103,0,0,3,6892,26690,0.0490074,0.0001451,0.3272767
1400000US29019001104,4,0,1,9895,47816,0.0919037,0.00070743,0.3364638
1400000US29019001201,1,1,2,5661,36250,0.0441112,0.00141318,0.3232008
1400000US29019001202,0,0,0,5299,47994,0.0541897,0.00075486,0.3504051
1400000US29019001300,3,1,4,3318,54881,0.1173826,0.00030139,0.3001547
1400000US29019001400,3,1,3,11027,59671,0.088033,0.00281128,0.248962
1400000US29019001502,0,0,1,6391,40600,0.2271973,0.00594586,0.1430446
1400000US29019001503,1,0,1,3330,50587,0.1677632,0.01021021,0.1709018
1400000US29019001504,4,0,6,8690,58047,0.1393581,0.0018412,0.2329706
1400000US29019001601,0,0,1,6639,16866,0.0684647,0.00346438,0.2806122
1400000US29019001602,1,0,0,3073,81053,0.0552995,0.00585747,0.2443715
1400000US29019001701,4,0,6,6903,58625,0.0441014,0.00115892,0.2351574
1400000US29019001702,1,0,1,4243,74615,0.0267286,0.00188546,0.2726952
1400000US29019001803,0,0,1,4226,39640,0.1030806,0.00520587,0.2388377
1400000US29019001805,0,1,0,8601,42674,0.0922377,0.00081386,0.3057616
1400000US29019001901,2,0,1,4333,28368,0.0615749,0.00207708,0.1651194
1400000US29019001902,3,0,2,7560,54821,0.0889179,0.00238095,0.1350558
1400000US29019002000,4,0,0,4835,71587,0.0942623,0.00124095,0.1531259
1400000US29019002100,3,0,9,2783,13079,0.3037543,0.00359325,0.1958831
1400000US29019002200,0,0,0,6879,35776,0.0625869,0.00029074,0.445614
1400000US29021000100,1,0,3,5862,36128,0.077634,0.00034118,0.2905444
1400000US29021000200,2,0,2,4753,27132,0.0839416,0.00084157,0.2072238
1400000US29021000300,2,0,1,3286,30122,0.1517241,0.00365186,0.1041056
1400000US29021000400,1,0,1,1628,73262,0.1930693,0.00429975,0.0824545
1400000US29021000500,1,0,1,2715,38498,0.121372,0.00368324,0.1439669
1400000US29021000600,5,1,1,5397,63409,0.0638144,0.00185288,0.1255129
1400000US29021000701,0,2,3,4593,55345,0.0833898,0.00065317,0.1103553
1400000US29021000702,0,0,0,4268,49661,0.0918599,0.00164011,0.1525015
1400000US29021000900,3,0,3,4764,27265,0.1235834,0.00167926,0.1905219
1400000US29021001100,1,0,1,2970,56815,0.3513296,0.00505051,0.0839304
1400000US29021001200,0,0,2,2183,50847,0.2632197,0.00549702,0.1638066
1400000US29021001500,3,1,2,5168,34877,0.1415,0.00232198,0.109834
1400000US29021001600,2,0,2,2640,51985,0.1297837,0.0030303,0.1680961
1400000US29021001700,2,1,2,4742,56302,0.0551268,0.00316322,0.103717
1400000US29021001800,0,0,1,3192,37813,0.1609719,0.0037594,0.1151611
1400000US29021002100,0,0,1,2381,55434,0.1104972,0.00461991,0.0384381
1400000US29021002200,0,0,1,1767,48152,0.0324401,0.00622524,0.1796311
1400000US29021002300,3,0,1,2622,46902,0.1037118,0.00228833,0.11772
1400000US29021002500,1,0,1,2028,18056,0.1410694,0.00493097,0.0198441
1400000US29021002700,1,0,0,3104,48073,0.100983,0.00193299,0.1433414
1400000US29021002800,0,0,0,4763,48935,0.102916,0.00146966,0.0952529
1400000US29021002900,2,0,1,3198,38161,0.0584,0.00531582,0.1170644
1400000US29021003000,0,0,3,5472,23365,0.2732949,0.00767544,0.0335117
1400000US29023950100,1,1,0,4645,64867,0.1272727,0.00193757,0.1006071
1400000US29023950201,1,0,0,4819,30965,0.0093226,0.00041502,0.0969267
1400000US29023950202,0,0,0,4902,102331,0.1675729,0.00305998,0.1009698
1400000US29023950300,8,0,4,7406,13503,0.183982,0.00310559,0.1498171
1400000US29023950400,0,0,0,3614,27543,0.3398058,0.00553403,0.0394154
1400000US29023950500,0,0,0,2514,46159,0.327768,0.00795545,0.0113095
1400000US29023950600,2,0,2,4310,36404,0.2354286,0.00301624,0.0819419
1400000US29023950700,1,0,1,3110,45870,0.4456343,0.00450161,0.0153509
1400000US29023950800,0,0,1,3064,30361,0.2758101,0.00881201,0.034919
1400000US29023950900,0,0,0,4053,32523,0.1981068,0.00444116,0.0588028
1400000US29025950100,4,0,0,2863,63292,0.1463009,0.00314356,0.0897571
1400000US29025950200,8,0,2,6517,24063,0.1177621,0.00276201,0.0774266
1400000US29027070100,2,0,1,4723,41786,0.0699894,0.00359941,0.1093898
1400000US29027070200,0,0,0,3931,66107,0.167336,0.00559654,0.0868545
1400000US29027070300,3,1,2,7711,34485,0.1205148,0.00324212,0.1183889
1400000US29027070400,2,0,2,5613,30156,0.1371728,0.00481026,0.1491564
1400000US29027070500,0,1,2,4509,24684,0.0323544,0.00266134,0.1956258
1400000US29027070600,6,0,3,6855,30396,0.0922654,0.00408461,0.0974863
1400000US29027070700,1,0,3,6031,28482,0.0726908,0.00315039,0.1900943
1400000US29027070800,1,0,1,4396,36672,0.1262192,0.00295723,0.1263391
1400000US29029950100,0,0,0,4575,49229,0.0443038,0.00065574,0.2163355
1400000US29029950200,1,0,2,6094,80021,0.0997141,0.00196915,0.2015968
1400000US29029950300,0,0,0,1739,65074,0.0155875,0.00287522,0.1208191
1400000US29029950400,0,0,2,3504,52104,0.1730486,0.00228311,0.1618339
1400000US29029950500,2,0,3,3925,36250,0.1636134,0.00178344,0.1000767
1400000US29029950600,0,0,0,4203,65595,0.1028213,0.00142755,0.1365971
1400000US29029950700,2,0,0,3823,76486,0.1597023,0.00366205,0.0718485
1400000US29029950800,4,0,1,6713,108293,0.1392356,0.00268137,0.0657952
1400000US29029950900,2,0,3,3379,62644,0.1155978,0.00207162,0.0623862
1400000US29029951100,0,0,0,3098,25987,0.0975293,0.00096837,0.197639
1400000US29029951200,1,0,0,2104,32250,0.0394089,0.00142586,0.0778443
1400000US29031880100,2,0,1,5895,19975,0.0543621,0.00186599,0.1478414
1400000US29031880200,1,0,0,3489,102450,0.0625465,0.00315277,0.1712032
1400000US29031880300,1,0,0,4494,42534,0.10252,0.00200267,0.1074735
1400000US29031880400,5,2,2,6528,40411,0.1172676,0.0010723,0.1402023
1400000US29031880500,1,0,2,9092,30202,0.0812665,0.00186978,0.1806688
1400000US29031880600,3,0,0,6046,19716,0.0993492,0.00198478,0.2054545
1400000US29031880700,0,0,0,4286,34458,0.0365322,0.00023332,0.3602613
1400000US29031880800,0,1,0,4431,37708,0.205845,0.00045137,0.181888
1400000US29031880900,0,0,0,2600,49375,0.1832325,0.00769231,0.1032832
1400000US29031881100,2,1,4,2906,31180,0.1263307,0.00240881,0.2000912
1400000US29031881200,2,2,2,5710,15149,0.039805,0.00052539,0.2295844
1400000US29031881300,0,0,2,6078,51389,0.1329942,0.00246792,0.2185448
1400000US29031881400,1,1,1,2923,28750,0.6034799,0.00615806,0.0692641
1400000US29031881500,3,1,1,4703,38806,0.0774929,0.00170104,0.1352063
1400000US29031881600,1,0,0,3108,35254,0.3098373,0.0019305,0.0441696
1400000US29033960100,2,0,0,2559,61902,0.1007678,0.00117233,0.0897577
1400000US29033960200,1,0,0,2818,34755,0.0648148,0.00141945,0.1330917
1400000US29033960300,2,0,4,4108,34591,0.1059565,0.00730282,0.1265189
1400000US29035960100,3,0,1,3750,35756,0.2017253,0,0.038214
1400000US29035960200,1,0,1,2391,90375,0.205819,0.00083647,0.0927835
1400000US29037060001,1,0,1,4111,55769,0.0326371,0.0024325,0.1980797
1400000US29037060003,1,0,2,3417,86060,0.0879121,0.00146327,0.1615662
1400000US29037060004,0,0,1,5488,62222,0.1622177,0.00400875,0.0964251
1400000US29037060100,0,0,0,1563,76788,0.0318258,0.00191939,0.1639344
1400000US29037060202,7,0,3,4892,53547,0.089011,0.00143091,0.164109
1400000US29037060301,3,2,5,8384,39771,0.040404,0.00059637,0.2010096
1400000US29037060302,1,0,2,7119,22204,0.0529121,0.00323079,0.1952217
1400000US29037060305,1,0,0,4392,23723,0.0459619,0.00068306,0.1701972
1400000US29037060400,1,0,0,4293,59531,0.0319607,0.00093175,0.2773609
1400000US29037060500,0,0,0,3156,39488,0.0778612,0.00126743,0.1471503
1400000US29037060600,4,0,2,7488,54750,0.098869,0.00106838,0.1053845
1400000US29037060700,0,0,1,3781,36278,0.0868659,0.00211584,0.1241624
1400000US29037060800,1,0,1,5911,41713,0.0906193,0.0006767,0.1194472
1400000US29037060904,2,0,0,3053,43300,0.0639004,0.00262037,0.1143162
1400000US29037061001,0,0,0,4540,86528,0.0239766,0.00154185,0.0956416
1400000US29037061002,3,0,1,6431,74365,0.0717489,0.00217696,0.1496768
1400000US29037061100,4,0,1,4322,54018,0.0678466,0.00300787,0.1416777
1400000US29037061200,5,0,2,3870,81527,0.0629053,0.00258398,0.1091686
1400000US29037061300,0,1,0,5871,35976,0.1640325,0.00272526,0.1433729
1400000US29037061400,4,1,1,5516,73762,0.1613222,0.00145033,0.0572132
1400000US29039870100,0,1,0,5881,83611,0.1422451,0.00221051,0.0607006
1400000US29039870200,3,1,3,4748,66123,0.20748,0.00358046,0.0826184
1400000US29039870300,2,0,0,3462,34536,0.1099678,0.0023108,0.1132376
1400000US29041470100,2,0,0,2373,54329,0.027533,0,0.0786325
1400000US29041470200,4,0,2,2664,36338,0.0926573,0.00225225,0.0803942
1400000US29041470300,1,1,1,2834,71047,0.095151,0.00211715,0.117773
1400000US29043020101,2,0,0,2992,50183,0.1007252,0.0026738,0.1409396
1400000US29043020102,1,0,3,4740,47917,0.0763314,0.00084388,0.1334864
1400000US29043020201,0,0,0,4194,43451,0.0521108,0,0.2440174
1400000US29043020202,1,0,4,5714,46271,0.0820468,0.00175009,0.1335797
1400000US29043020203,2,0,4,5394,26267,0.0736138,0.00092696,0.2305492
1400000US29043020204,2,0,3,3674,27431,0.1153574,0.00027218,0.1998303
1400000US29043020205,3,0,2,6299,45121,0.0993761,0.00174631,0.2966056
1400000US29043020302,1,0,2,5853,42886,0.0935646,0.00222108,0.2372924
1400000US29043020303,1,0,1,4932,38958,0.0828272,0.00182482,0.1766242
1400000US29043020304,0,0,0,3065,56042,0.1810277,0.00554649,0.168004
1400000US29043020305,1,0,4,5713,33861,0.0541702,0.00052512,0.2518919
1400000US29043020306,2,0,1,7247,21654,0.053244,0.00027598,0.2456793
1400000US29043020400,2,0,2,7676,37358,0.0946502,0.00208442,0.1281293
1400000US29043020500,5,1,1,6663,0,0.0857586,0.00300165,0.1447686
1400000US29045950100,0,0,0,1949,44985,0.0828947,0,0.0791726
1400000US29045950200,0,0,1,2172,72468,0.1108597,0,0.095366
1400000US29045950300,3,0,1,3048,45500,0.0891174,0.00262467,0.1188707
1400000US29047020201,1,1,0,5340,33654,0.1124531,0.00205993,0.1226361
1400000US29047020202,1,0,0,3642,63963,0.0191617,0.00054915,0.351361
1400000US29047020300,1,0,1,6951,42011,0.0992754,0.00115091,0.2250336
1400000US29047020400,2,0,0,2549,58105,0.0354978,0.00117693,0.1936641
1400000US29047020500,0,0,0,5380,35364,0.1100561,0.00464684,0.1365159
1400000US29047020602,2,0,1,3492,43750,0.1737858,0.00085911,0.1473595
1400000US29047020603,2,0,0,3418,39915,0.1354698,0.00263312,0.0555318
1400000US29047020604,3,1,2,4594,47273,0.1141751,0.00217675,0.137573
1400000US29047020801,7,1,3,6846,31934,0.0692226,0.0024832,0.1679453
1400000US29047020901,1,2,1,5899,36918,0.0706827,0.00203424,0.2043246
1400000US29047020902,1,0,0,2414,27579,0.1216216,0.0024855,0.1811506
1400000US29047021001,1,0,2,3376,77317,0.1743796,0.00414692,0.1433165
1400000US29047021003,0,0,0,4082,40076,0.0310752,0.00097991,0.2596913
1400000US29047021004,1,0,1,3124,36700,0.088729,0.00224072,0.1902277
1400000US29047021101,2,2,2,4518,31869,0.0819423,0.00243471,0.1409047
1400000US29047021102,2,1,0,6409,45858,0.089837,0.00109221,0.1983702
1400000US29047021103,0,0,1,3559,15682,0.0298013,0.00196685,0.1887858
1400000US29047021204,1,0,0,5241,26042,0.2602284,0.00133562,0.1476176
1400000US29047021205,1,0,3,5995,82409,0.0225105,0.00016681,0.2422495
1400000US29047021206,4,0,2,7166,30938,0.0290155,0.00055819,0.2477997
1400000US29047021207,0,0,1,2207,50000,0.0581633,0.00135931,0.1864952
1400000US29047021208,0,0,0,6003,34943,0.0448365,0.00083292,0.2411991
1400000US29047021303,1,0,0,2550,39933,0.0846433,0.00117647,0.3256579
1400000US29047021305,1,0,0,7492,37396,0.0721852,0.00106781,0.2051858
1400000US29047021306,2,0,0,7563,47932,0.0259918,0.00105778,0.2852134
1400000US29047021307,1,0,1,5030,61800,0.0337942,0.00079523,0.2835526
1400000US29047021309,1,0,0,3441,48354,0.0080241,0.00029061,0.330587
1400000US29047021310,0,0,1,5423,55594,0.0245687,0.000922,0.3465231
1400000US29047021401,0,0,1,4505,45868,0.0637481,0.0008879,0.2368194
1400000US29047021403,2,0,0,3329,66338,0.0691376,0.00841093,0.1397403
1400000US29047021404,2,0,3,4113,81821,0.1141304,0.00170192,0.2407291
1400000US29047021600,3,0,0,7811,31335,0.0816982,0.0010242,0.2253206
1400000US29047021701,4,0,3,5034,29299,0.0704752,0.0011919,0.0927649
1400000US29047021702,2,0,2,6540,44800,0.1410055,0.00259939,0.067355
1400000US29047021803,1,0,0,6168,77847,0.0089526,0.00064851,0.3134734
1400000US29047021804,1,1,1,6524,24447,0.0375458,0.00091968,0.1959763
1400000US29047021805,3,0,1,8003,35675,0.0154951,0.00062477,0.2410342
1400000US29047021806,0,0,2,3458,62455,0.0085592,0.00433777,0.1333614
1400000US29047021900,0,0,0,5137,30810,0.0175345,0.00097333,0.2445478
1400000US29047022000,3,0,3,4337,72694,0.0978941,0.00184459,0.1905576
1400000US29047022100,1,0,4,4391,72400,0.0739423,0.00956502,0.1611922
1400000US29047022200,1,0,2,3559,72109,0.0777856,0.0025288,0.102714
1400000US29047022301,1,1,1,2763,52488,0.0620861,0.00180963,0.1603875
1400000US29047022302,1,0,0,5639,99961,0.0564127,0.00035467,0.2904168
1400000US29049960100,3,0,3,5132,36752,0.1517723,0.00214341,0.1101404
1400000US29049960200,3,0,0,7006,77625,0.0750916,0.00171282,0.1051107
1400000US29049960300,3,0,2,4096,39681,0.048854,0.00366211,0.1225937
1400000US29049960400,2,0,0,4448,22490,0.0564706,0.00269784,0.1133106
1400000US29051010300,2,2,3,4859,30349,0.0437788,0.00308706,0.2001198
1400000US29051010400,1,0,3,6711,41926,0.0831826,0.00253316,0.2627897
1400000US29051010500,4,1,4,5768,24794,0.2337229,0.00398752,0.1254919
1400000US29051010600,2,2,6,4046,22946,0.1659056,0.00148295,0.2251908
1400000US29051010701,2,1,4,5332,43646,0.0258269,0.00075019,0.2313266
1400000US29051010702,1,0,5,4560,49500,0.059726,0.00197368,0.2853933
1400000US29051010800,0,0,5,8197,43333,0.0525229,0.00170794,0.3134538
1400000US29051010900,2,1,2,6145,47003,0.1000794,0.00211554,0.233091
1400000US29051020198,0,1,2,6071,91971,0.0335664,0.00049415,0.1051276
1400000US29051020200,3,2,1,3986,21288,0.0290368,0.00175615,0.1921084
1400000US29051020300,2,0,0,3589,77128,0.0145349,0.00111452,0.1392675
1400000US29051020400,0,0,1,6244,22077,0.1026182,0.00224215,0.1607276
1400000US29051020500,3,0,1,2785,59266,0.0435572,0.00179533,0.1370474
1400000US29051020600,0,1,0,4221,59554,0.0748792,0.00284293,0.1446252
1400000US29051020700,1,1,4,2253,93581,0.3111111,0.00621394,0.0917431
1400000US29053950100,2,1,0,2912,48936,0.0953587,0.00206044,0.1635282
1400000US29053950200,3,1,0,3051,22181,0.1694153,0.00262209,0.0522667
1400000US29053950300,3,0,3,4019,41466,0.0617359,0.00248818,0.1181588
1400000US29053950400,0,0,0,2445,61592,0.1750503,0.00368098,0.1665689
1400000US29053950500,7,1,1,5156,39075,0.1368146,0.00310318,0.0774648
1400000US29055450101,0,0,1,1896,53460,0.0721785,0.00580169,0.1213916
1400000US29055450102,3,0,1,6557,107031,0.1717172,0.00289767,0.0784684
1400000US29055450200,0,0,0,4124,41384,0.1361386,0.00339476,0.0281787
1400000US29055450301,0,0,0,2840,53902,0.0761468,0.0028169,0.1504803
1400000US29055450302,3,1,2,4351,106415,0.199066,0.00344748,0.0689417
1400000US29055450400,0,0,1,4872,86262,0.1465969,0.00348933,0.0564904
1400000US29057480100,4,0,1,4648,28112,0.1561514,0.00150602,0.0465811
1400000US29057480200,1,0,0,3281,43205,0.0989811,0.00030479,0.0889774
1400000US29059480100,0,1,0,4806,46054,0.1515464,0.00124844,0.0694485
1400000US29059480200,2,0,3,5557,45498,0.2871103,0.00215944,0.1017798
1400000US29059480300,0,0,0,6450,36351,0.1099788,0.00015504,0.0846951
1400000US29061470100,2,0,0,2988,29198,0.0516432,0.00167336,0.098076
1400000US29061470200,4,4,0,5371,58226,0.1303483,0.0037237,0.1008876
1400000US29063080100,2,0,2,9098,100347,0.1431468,0.00087931,0.084226
1400000US29063080200,6,0,0,3774,41597,0.0695652,0.00264971,0.0888383
1400000US29065960100,0,0,0,5124,55679,0.1397849,0.00019516,0.0680658
1400000US29065960200,0,0,0,4918,123750,0.1056564,0,0.0782382
1400000US29065960300,1,0,2,2084,37235,0.1554054,0.00383877,0.1036745
1400000US29065960400,2,0,1,3371,110648,0.2044003,0.00415307,0.0667575
1400000US29067950100,1,0,0,3945,26810,0.1499293,0,0.0595543
1400000US29067950200,1,0,0,6022,87206,0.1086957,0,0.0694617
1400000US29067950500,3,0,1,3722,32950,0.1250798,0.00134336,0.0744723
1400000US29069360100,0,0,1,2406,18560,0.4222222,0.00872818,0.0279402
1400000US29069360200,2,0,2,3134,53244,0.1729323,0.00159541,0.0470297
1400000US29069360300,0,0,0,4359,55463,0.2537237,0.00183528,0.0474976
1400000US29069360400,0,0,0,4181,39191,0.2209649,0.00334848,0.0377711
1400000US29069360500,2,0,1,3920,56991,0.2871708,0.00433674,0.0753556
1400000US29069360600,1,0,0,4568,86636,0.3174157,0.00481611,0.0672579
1400000US29069360700,4,0,2,3099,49621,0.1452312,0.00387222,0.0818308
1400000US29069360800,0,0,0,2243,57411,0.3567182,0.00401248,0.0629096
1400000US29069360900,1,0,0,2031,63731,0.2520612,0.00049237,0.078169
1400000US29069361000,2,0,0,2199,72208,0.2996845,0.00363802,0.0422078
1400000US29071800100,2,1,1,8816,35439,0.0646944,0.00272232,0.1127883
1400000US29071800201,2,0,2,5182,86154,0.0757904,0.00366654,0.175
1400000US29071800202,0,0,2,5567,31633,0.0276865,0.00107778,0.1671958
1400000US29071800300,3,3,1,7778,74375,0.0706416,0.00179995,0.1695849
1400000US29071800401,5,0,2,5328,16983,0.0298031,0.00037538,0.0961593
1400000US29071800402,0,1,0,7182,40000,0.1117381,0.00222779,0.0929447
1400000US29071800500,2,0,2,7325,53395,0.0615929,0.00273038,0.0568522
1400000US29071800601,6,1,5,6547,49483,0.1165492,0.00213838,0.101757
1400000US29071800602,0,0,2,7875,30737,0.0872131,0.00393651,0.1489444
1400000US29071800701,6,1,0,6905,58736,0.0942029,0.00115858,0.089562
1400000US29071800702,0,0,0,2628,43479,0.1222222,0.00114155,0.1238532
1400000US29071800800,1,0,0,7650,38045,0.0610716,0.00457516,0.0617956
1400000US29071800901,1,0,0,2788,58684,0.0951374,0.00215208,0.0189546
1400000US29071800902,4,2,4,6695,35746,0.2024493,0.0034354,0.0527211";**/

void setup() {
  size(1000,1000);
 //data = split(rawData, "\n");
  data = loadStrings(fileName);
  colNames = split(data[0], ",");
  dataLen = data.length - 1;
  //surface.setResizable(true);
  mins = new float[colNames.length - 1];
  for(int i = 0; i < colNames.length - 1; i++) {
    mins[i] =  100000.0;
  }
  maxes = new float[colNames.length - 1];
  togglesHaveChanged = false;
  frameHeight = 0.6 * height;
  marginX = (width - frameWidth) / 2.0;
  topMargin = (height - frameHeight) / 3.0;
   
  orientations = new int[colNames.length - 1];
  colorSelectionModes = new boolean[colNames.length-1];
  dimensionSelected = new boolean[colNames.length-1];
  topKnobHeights = new float[colNames.length-1];
  bottomKnobHeights = new float[colNames.length-1];
  togglingTop = new boolean[colNames.length-1];
  togglingBottom = new boolean[colNames.length-1];
  beingDragged = new boolean[colNames.length-1];
  for(int i = 0; i < colNames.length - 1; i++) {
    maxes[i] =  -100000.0;
    orientations[i] = 0;
    colorSelectionModes[i] = false;
    dimensionSelected[i] = false;
    togglingBottom[i] = false;
    togglingTop[i] = false;
    beingDragged[i] = false;
  }
  for(int i = 1; i < data.length; i++) {
    String[] currentRow = split(data[i], ",");
     for(int j = 1; j < colNames.length; j++) {
         mins[j-1] = min(new Float(currentRow[j]),mins[j-1]); 
         maxes[j-1] = max(new Float(currentRow[j]),maxes[j-1]); 
     }
  }
  //Precompute positions on line
  dataPositions = new float[data.length-1][colNames.length-1];
  for(int i = 1; i < data.length; i++) {
    String[] currentRow = split(data[i], ",");
    for(int j = 1; j < colNames.length; j++) {
      dataPositions[i-1][j-1] = ((new Float(currentRow[j])) - mins[j-1]) / (maxes[j-1] - mins[j-1]);
    }
  }
  
  f = createFont("Times New Roman", 16, true);
  rectangleSelection = false;
}

//Cross product test to see if point within sides of triangle
float inTriangleHelper(float point1x, float point1y, float point2x, float point2y, float point3x, float point3y) {
    return ((point2y - point3y) * (point1x - point3x)) - ((point1y - point3y) * (point2x - point3x));
}

//Used for dimension scale sliders and reorder button
boolean inTriangle(float v1x, float v1y, float v2x, float v2y, float v3x, float v3y, float px, float py) {
  float vec1 = inTriangleHelper(px, py, v1x, v1y, v2x, v2y);
  float vec2 = inTriangleHelper(px, py, v2x, v2y, v3x, v3y);
  float vec3 = inTriangleHelper(px, py, v3x, v3y, v1x, v1y);
  
  boolean sign1 = vec1 < 0.0;
  boolean sign2 = vec2 < 0.0;
  boolean sign3 = vec3 < 0.0;
  return (sign1 == sign2) && (sign2 == sign3);
}

//Test if rectangle or mouse over line
boolean closeToLine(float x0, float y0, float x1, float y1) {
  float dx = x1 - x0;
  float dy = y1 - y0;
  float xComponent = ((mouseX - x0) * dx);
  float yComponent = ((mouseY - y0) * dy);
  float t = (yComponent + xComponent) / (dy*dy + dx*dx);
  float xIntersection = x0 + t * dx;
  float yIntersection = y0 + t * dy;
  
  if(t < 0) {
    xIntersection = x0;
    yIntersection = y0;
  }
  if(t > 1) {
    xIntersection =  x1;
    yIntersection = y1;
  }
  float ptLineDistanceX = xIntersection - mouseX;
  float ptLineDistanceY = yIntersection - mouseY;
  
  if(sqrt(ptLineDistanceX*ptLineDistanceX + ptLineDistanceY * ptLineDistanceY) < 1.0) {
    return true; 
  }
  else {
    return false; 
  }
}

//Used for dragging toggles and switching dimensions
void mousePressed() {
 rectangleSelection = true;
 rectangleAnchorX = mouseX;
 rectangleAnchorY = mouseY;
 
 for(int i = 1; i < colNames.length; i++) {
   float topKnobPosition = topMargin + (frameHeight * topKnobHeights[i-1]);
   if(inTriangle(marginX + (i-1) * lineWidthIncrement, topKnobPosition, (marginX + (i-1) * lineWidthIncrement) - 10.1, topKnobPosition - 7.6, (marginX + (i-1) * lineWidthIncrement) + 10.1, topKnobPosition - 7.6,mouseX, mouseY)) {
     togglesHaveChanged = true;
     togglingTop[i-1] = true;
   }
   float bottomKnobPosition = topMargin + (frameHeight * bottomKnobHeights[i-1]);
   if(inTriangle(marginX + (i-1) * lineWidthIncrement, bottomKnobPosition, (marginX + (i-1) * lineWidthIncrement) - 10.1, bottomKnobPosition + 7.6, (marginX + (i-1) * lineWidthIncrement) + 10.1, bottomKnobPosition + 7.6, mouseX, mouseY)) {
     togglesHaveChanged = true;
     togglingBottom[i-1] = true;
   }
   
   if(inTriangle((marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement) - (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height), (marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight + (0.04 * height), mouseX, mouseY) || 
         inTriangle((marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight + (0.04 * height), (marginX + (i-1) * lineWidthIncrement) + (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height), mouseX, mouseY)
      ) {
      beingDragged[i-1] = true;  
   }
 }
}

//Used when clicking buttons
void mouseClicked() {
  for(int i = 1; i < colNames.length; i++) {
    //Flip orientation if intersect toggle
    if(mouseX > (marginX + (i-1) * lineWidthIncrement)-(0.02*width) && mouseX < ((marginX + (i-1) * lineWidthIncrement)-(0.02*width)) + (0.04*width) && mouseY > 1.75*topMargin + frameHeight && mouseY < (1.75*topMargin + frameHeight) + 0.04*height) {
      if(orientations[i-1] == 0) {
        orientations[i-1] = 1;
      }
      else {
        if(orientations[i-1] == 1) {
           orientations[i-1] = 0;
        }
      }
    }
    
    //Toggle on/off gradient modes for axes
    if(mouseX > (marginX + (i-1) * lineWidthIncrement)-(0.03*width) && mouseX < (marginX + (i-1) * lineWidthIncrement)-(0.03*width) + (0.04*width) && mouseY > 2.15*topMargin + frameHeight && mouseY < 2.15*topMargin + frameHeight + 0.04*height) {
      if(!colorSelectionModes[i-1]) {
        for(int j = 1; j < colNames.length; j++) {
          colorSelectionModes[j-1] = false;
        }
        colorSelectionModes[i-1] = true;
      }
      else {
        for(int j = 1; j < colNames.length; j++) {
          colorSelectionModes[j-1] = false;
        }
        colorSelectionModes[i-1] = false; 
      }
    }
     if(mouseX > marginX + (i-1) * lineWidthIncrement - 2.0 && mouseX < marginX + (i-1) * lineWidthIncrement + 2.0 && mouseY > topMargin && mouseY < topMargin + frameHeight) {
       dimensionSelected[i-1] = !dimensionSelected[i-1];
     }
   }
}

//Swap two dimensions: used during reordering
void swapColumns(int col1, int col2) {
  //colNames[i]
  String tempColumnName = colNames[col1+1];
  colNames[col1+1] = colNames[col2+1];
  colNames[col2+1] = tempColumnName;
  
  float tempMin = mins[col1];
  mins[col1] = mins[col2];
  mins[col2] = tempMin;
  
  float tempMax = maxes[col1];
  maxes[col1] = maxes[col2];
  maxes[col2] = tempMax;
  
  for(int i = 1; i < data.length; i++) {
      
      float dataTemp = dataPositions[i-1][col1];
      dataPositions[i-1][col1] = dataPositions[i-1][col2];
      dataPositions[i-1][col2] = dataTemp; 
  }
  
  int tempOrientation = orientations[col1];
  orientations[col1] = orientations[col2];
  orientations[col2] = tempOrientation;
  
  float tempTopKnob = topKnobHeights[col1];
  topKnobHeights[col1] = topKnobHeights[col2];
  topKnobHeights[col2] = tempTopKnob;
  
  float tempBottomKnob = bottomKnobHeights[col1];
  bottomKnobHeights[col1] = bottomKnobHeights[col2];
  bottomKnobHeights[col2] = tempBottomKnob;
  
  boolean colorSelectionMode =  colorSelectionModes[col1];
  colorSelectionModes[col1] = colorSelectionModes[col2];
  colorSelectionModes[col2] = colorSelectionMode;
  
  boolean tempSelected = dimensionSelected[col1];
  dimensionSelected[col1] = dimensionSelected[col2];
  dimensionSelected[col2] = tempSelected;
  
  
  
}

//Stop selecting with rectangle
void mouseReleased() {
 rectangleSelection = false;
 for(int j = 1; j < colNames.length; j++) {
   togglingTop[j-1] = false;
   togglingBottom[j-1] = false;
   if(beingDragged[j-1]) {
      float prevXPosition = (marginX + (j-1) * lineWidthIncrement);
      if(mouseX > prevXPosition) {
         int shiftedColumns = 0;
         for(int k = j; k < colNames.length; k++) {
           if(marginX + (k * lineWidthIncrement) < mouseX) {
              shiftedColumns += 1; 
           }
         }
         for(int i = 0; i < shiftedColumns; i++) {
           swapColumns(j - 1 + i, j + i); 
         }
      }
      else {
        int shiftedColumns = 0;
        for(int k = j - 2; k >= 0; k -= 1) {
           if(marginX + (k * lineWidthIncrement) > mouseX) {
             shiftedColumns += 1;
           }
        }
        for(int i = 0; i < shiftedColumns; i++) {
          swapColumns(j - 1 - i, j - 2 -i); 
        }
      }
   }
   beingDragged[j-1] = false;
 }
}

//Used to test intersection with rectangle boundaries
boolean lineLineIntersection(float x0, float y0, float x1, float y1, float x01, float y01, float x11, float y11) {
  double a1 = y1 - y0;
  double b1 = x0 - x1;
  double c1 = (a1 * x0) + (b1 * y0);
  double a2 = y11 - y01;
  double b2 = x01 - x11;
  double c2 = (a2 * x01) + (b2 * y01);
  double det = (a1 * b2) - (a2 * b1);
  if(det == 0.0) {
    return false;
  }
  double xInt = ((b2 * c1) - (b1 * c2)) / det;
  double yInt = ((a1 * c2) - (a2 * c1)) / det;
  
  if((min(x0,x1) <= xInt && xInt <= max(x0,x1) && (min(y0,y1) <= yInt && yInt <= max(y0,y1)))) {
    if((min(x01,x11) <= xInt && xInt <= max(x01,x11)) || (min(y01,y11) <= yInt && yInt <= max(y01,y11))) {
    ellipse(x01,y01,5.0,5.0);
    ellipse(x11,y11,5.0,5.0);
    return true;  
    }
  }
  return false;
}

//Test if within or intersects rectangle
boolean selectedByRectangle(float x0, float y0, float x1, float y1) {
  float rectMinX = min(mouseX, rectangleAnchorX);
  float rectMinY = min(mouseY, rectangleAnchorY);
  float rectMaxX = max(mouseX, rectangleAnchorX);
  float rectMaxY = max(mouseY, rectangleAnchorY);
  if(x0 > rectMinX && x0 < rectMaxX && y0 > rectMinY && y0 < rectMaxY) {
    return true; 
  }
  if(x1 > rectMinX && x1 < rectMaxX && y1 > rectMinY && y1 < rectMaxY) {
    return true; 
  }
  if(lineLineIntersection(rectMinX, rectMinY, rectMaxX, rectMinY, x0, y0, x1, y1)) {
    return true; 
  }
  if(lineLineIntersection(rectMinX, rectMinY, rectMinX, rectMaxY, x0, y0, x1, y1)) {
    return true; 
  }
  if(lineLineIntersection(rectMinX, rectMaxY, rectMaxX, rectMaxY, x0, y0, x1, y1)) {
    return true; 
  }
  if(lineLineIntersection(rectMaxX, rectMinY, rectMaxX, rectMaxY, x0, y0, x1, y1)) {
    return true; 
  }
  return false;
  
}

void drawColumnAtMouse(int index) {
      text(colNames[index+1], (mouseX - 0.5*textWidth(colNames[index+1])), 1.5*topMargin + frameHeight);
      float currentMax = maxes[index];
      float currentMin = mins[index];
      
      String currentMaxStr = currentMax.toString();
      if(orientations[index] == 0) {
        text(currentMaxStr, (mouseX - 0.5*textWidth(currentMaxStr)), (0.8*topMargin));
      }
      if(colorSelectionModes[index]) {
         for(float j = topMargin; j < topMargin + frameHeight; j += 1.0) {
           float currentProportion = (j - topMargin) / frameHeight;
           color currentColor = lerpColor(gradientColor1, gradientColor2, currentProportion);
           if(orientations[index] == 1) {
             currentColor = lerpColor(gradientColor1, gradientColor2, 1.0-currentProportion);
           }
           stroke(currentColor);
           
           line(mouseX - 2.0, j, mouseX + 2.0, j);
         }
         strokeWeight(4.0);
         stroke(0.0);
      }
      else {
        fill(0.0);
        line(mouseX, topMargin, mouseX, topMargin + frameHeight);
        strokeWeight(4.0);
      }
      fill(0.0);
      
      String currentMinStr = currentMin.toString();
      if(orientations[index] == 0) {
        text(currentMinStr, (mouseX - 0.5*textWidth(currentMinStr)), (1.25*topMargin) + frameHeight);
      }
      if(orientations[index] == 1) {
        text(currentMinStr, (mouseX - 0.5*textWidth(currentMaxStr)) + (index) * lineWidthIncrement, (0.8*topMargin));
        text(currentMaxStr, (mouseX - 0.5*textWidth(currentMinStr)) + (index) * lineWidthIncrement, (1.25*topMargin) + frameHeight);
      }
      
      //Dimension range triangle toggles
      strokeWeight(2.0);
      fill(color(255.0,0.0,0.0));
      if(!togglesHaveChanged) {
        topKnobHeights[index] = 0.0;
        bottomKnobHeights[index] = 1.0;
      }
      topKnobHeights[index] = max(0.0, topKnobHeights[index]);
      if(togglingTop[index]) {
         topKnobHeights[index] = max(0.0,min(bottomKnobHeights[index], (mouseY - topMargin) / frameHeight));
      }
      bottomKnobHeights[index] = min(1.0, bottomKnobHeights[index]);
      if(togglingBottom[index]) {
        bottomKnobHeights[index] = min(1.0, max(0.0, (mouseY - topMargin) / frameHeight));  
      }
      
      triangle(mouseX, topMargin + (frameHeight * topKnobHeights[index]), mouseX - 10.0, (topMargin + (frameHeight * topKnobHeights[index])) - 7.5, mouseX + 10.0, (topMargin + (frameHeight * topKnobHeights[index])) - 7.5);
      fill(color(0.0,255.0,0.0));
      triangle(mouseX, topMargin + (frameHeight * bottomKnobHeights[index]), mouseX - 10.0, topMargin + (bottomKnobHeights[index] * frameHeight) + 7.5, mouseX + 10.0, topMargin+(bottomKnobHeights[index]*frameHeight) + 7.5);
      
      //Hovering over swap buttons
      if(orientations[index] == 1) {
        fill(color(255.0,255.0,255.0));
      }
      else {
        fill(color(0.0,255.0,0.0));
        if(mouseX > (marginX + (index) * lineWidthIncrement)-(0.02*width) && mouseX < ((marginX + (index) * lineWidthIncrement)-(0.02*width)) + (0.04*width) && mouseY > 1.75*topMargin + frameHeight && mouseY < (1.75*topMargin + frameHeight) + 0.04*height) {
          fill(color(0.0,255.0,250.0));
        }
      }
      //swap buttons
      rect(mouseX-(0.02*width), 1.75*topMargin + frameHeight, 0.04*width, 0.04*height);    
      fill(0.0);
      text("swap",mouseX-(0.015*width), 1.92*topMargin + frameHeight);
      
      //Gradient buttons
      fill(color(200.0,40.0,200.0));
      rect(mouseX-(0.03*width), 2.15*topMargin + frameHeight, 0.06*width, 0.04*height);
      fill(0.0);
      text("gradient",mouseX-(0.025*width), 2.32*topMargin + frameHeight);

      fill(color(255,215,0));
      
      //quad((marginX + (i-1) * lineWidthIncrement), (2.5*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement), (2.5*topMargin) + frameHeight + (0.04 * height), (marginX + (i-1) * lineWidthIncrement) - (0.07*width), (2.5*topMargin) + frameHeight + (0.02 * height), (marginX + (i-1) * lineWidthIncrement) + (0.07*width), (2.5*topMargin) + frameHeight + (0.02 * height));
      quad(mouseX, (2.55*topMargin) + frameHeight, mouseX - (0.06*width), (2.55*topMargin) + frameHeight + (0.02 * height), mouseX, (2.55*topMargin) + frameHeight + (0.04 * height), mouseX + (0.06*width), (2.55*topMargin) + frameHeight + (0.02 * height));
      fill(0.0);
      
      text("reordering", mouseX - (textWidth("reordering")/2.0), (2.55*topMargin) + frameHeight + (0.021 * height)); 
  
}


void draw() {
   //clear();
   background(255);
   fill(0);
   //Calculate position of axes and labels given current window proportions, then draw them
   frameWidth = 0.8 * width;
   frameHeight = 0.6 * height;
   marginX = (width - frameWidth) / 2.0;
   topMargin = (height - frameHeight) / 3.0;
   lineWidthIncrement = frameWidth / (colNames.length-2);
   float fontPercent = ((width / 1000.0) + (height / 1000.0)) / 2.0;
   float textSize = fontPercent * 16.0;
   if (textSize >= 1.0) {
     fontSize = (int)textSize;
   }
   text("Characteristics of census tracts", (width / 2.0) - (0.5 * textWidth("Characteristics of census tracts")), 0.25*topMargin);
   text("Click dimension to display scale", 0.6*marginX, 0.6 * topMargin);
   
 
 
 //Draw data lines
 strokeWeight(1);
 stroke(128);
 //Color lines according to selected dimension
 int colorGradientIndex = -1;
 int draggedIndex = -1;
 for(int i = 1; i < colNames.length; i++) {
   if(colorSelectionModes[i-1]) {
     colorGradientIndex = i - 1;
   }
   if(beingDragged[i-1]) {
     draggedIndex = i - 1;
   }
 }
 for(int i = 1; i < data.length; i++) {
   stroke(128); 
   float[] currentRow = dataPositions[i-1];
   //If dimension selected, color data lines according to that dimension
   if(colorGradientIndex != -1) {
     color currentColor = lerpColor(gradientColor1, gradientColor2,1.0-currentRow[colorGradientIndex]);
     stroke(currentColor);
   }
   boolean inRange = true;
   for(int j = 0; j < currentRow.length-1; j++) {
      if(j == draggedIndex || j + 1 == draggedIndex) {
        continue; 
      }
      float pos1Y = topMargin + ((1.0 - currentRow[j]) * frameHeight);
      
      if(orientations[j] == 1) {
        pos1Y = topMargin + (currentRow[j] * frameHeight);
      }
      if(pos1Y < topMargin + (topKnobHeights[j] * frameHeight) || pos1Y > topMargin + (bottomKnobHeights[j] * frameHeight)) {
        inRange = false;
        break;
      }
      
      float pos2Y = topMargin + ((1.0 - currentRow[j+1]) * frameHeight);
      if(orientations[j+1] == 1) {
        pos2Y = topMargin + (currentRow[j+1] * frameHeight);
      }
      if(pos2Y < topMargin + (topKnobHeights[j+1] * frameHeight) || pos2Y > topMargin + (bottomKnobHeights[j+1] * frameHeight)) {
        inRange = false;
        break;
      }
   }
   if(!inRange) {
     continue; 
   }
   for(int j = 0; j < currentRow.length-1; j++) {
     //Dont draw in original place if dimension being reordered.
     if(j == draggedIndex || j + 1 == draggedIndex) {
        continue; 
      }
      float pos1Y = topMargin + ((1.0 - currentRow[j]) * frameHeight);
      float pos2Y = topMargin + ((1.0 - currentRow[j+1]) * frameHeight);
      if(orientations[j] == 1) {
        pos1Y = topMargin + (currentRow[j] * frameHeight);
      }
      if(orientations[j+1] == 1) {
        pos2Y = topMargin + (currentRow[j+1] * frameHeight);
      }
      //If mouse hovers over one segment of data point, then highlight all lines of data point
      if(!rectangleSelection && closeToLine(marginX + j * lineWidthIncrement, pos1Y, marginX + (j+1) * lineWidthIncrement, pos2Y)) {
        stroke(color(0.0,0.0,255.0));
        for(int k = 0; k < currentRow.length-1; k++) {
             pos1Y = topMargin + ((1.0 - currentRow[k]) * frameHeight);
             pos2Y = topMargin + ((1.0 - currentRow[k+1]) * frameHeight);
             if(orientations[k] == 1) {
                pos1Y = topMargin + (currentRow[k] * frameHeight);
             }
             if(orientations[k+1] == 1) {
                pos2Y = topMargin + (currentRow[k+1] * frameHeight);
             }
             line(marginX + k * lineWidthIncrement, pos1Y, marginX + (k+1) * lineWidthIncrement, pos2Y);
         }
         break;
      }
      if(rectangleSelection) {
        //If rectangle contains or intersects one segment of data point, then highlight all lines of data point
        if(selectedByRectangle(marginX + j * lineWidthIncrement, pos1Y, marginX + (j+1) * lineWidthIncrement, pos2Y)) {
          stroke(color(0.0,0.0,255.0));
          for(int k = 0; k < currentRow.length-1; k++) {
             if(k == draggedIndex || k + 1 == draggedIndex) {
              continue; 
             }
             pos1Y = topMargin + ((1.0 - currentRow[k]) * frameHeight);
             pos2Y = topMargin + ((1.0 - currentRow[k+1]) * frameHeight);
             if(orientations[k] == 1) {
                pos1Y = topMargin + (currentRow[k] * frameHeight);
             }
             if(orientations[k+1] == 1) {
                pos2Y = topMargin + (currentRow[k+1] * frameHeight);
             }
             line(marginX + k * lineWidthIncrement, pos1Y, marginX + (k+1) * lineWidthIncrement, pos2Y);
          }
          break;
        }
      }
      
      line(marginX + j * lineWidthIncrement, pos1Y, marginX + (j+1) * lineWidthIncrement, pos2Y);
   }
 }
 
 if(rectangleSelection) {
   fill(color(0,0,255),0.5);
   rect(min(mouseX, rectangleAnchorX),min(mouseY, rectangleAnchorY), abs(mouseX - rectangleAnchorX), abs(mouseY - rectangleAnchorY));
 }
 
   textFont(f, fontSize);
   strokeWeight(4);
   fill(0.0);
   stroke(0);
   for(int i = 1; i < colNames.length; i++) {
      if(i - 1 == draggedIndex) {
              continue; 
      }
      
      text(colNames[i], (marginX - 0.5*textWidth(colNames[i])) + (i-1) * lineWidthIncrement, 1.5*topMargin + frameHeight);
      float currentMax = maxes[i-1];
      float currentMin = mins[i-1];
      //If dimension clicked on, display scale
      if(dimensionSelected[i-1]) {
        for(float j = 1.0; j <= 4.0; j += 1.0) {
           float currentYPos = topMargin + ((j / 5.0) * frameHeight);
           float axisValue = ((5.0 - j) / 5.0) *(currentMax - currentMin);
           if(orientations[i-1] == 1) {
             axisValue = (j / 5.0) * (currentMax - currentMin);
           }
           text(axisValue.toString(), marginX + (i-1) * lineWidthIncrement - textWidth(axisValue.toString()) - 6.0,currentYPos);
        }
      }
      
      String currentMaxStr = currentMaxtoString();
      if(orientations[i-1] == 0) {
        text(currentMaxStr, (marginX - 0.5*textWidth(currentMaxStr)) + (i-1) * lineWidthIncrement, (0.8*topMargin));
      }
      if(colorSelectionModes[i-1]) {
         if(mouseX > marginX + (i-1) * lineWidthIncrement - 2.0 && mouseX < marginX + (i-1) * lineWidthIncrement + 2.0 && mouseY > topMargin && mouseY < topMargin + frameHeight) {
           strokeWeight(8); 
         }
         for(float j = topMargin; j < topMargin + frameHeight; j += 1.0) {
           float currentProportion = (j - topMargin) / frameHeight;
           color currentColor = lerpColor(gradientColor1, gradientColor2, currentProportion);
           if(orientations[i-1] == 1) {
             currentColor = lerpColor(gradientColor1, gradientColor2, 1.0-currentProportion);
           }
           stroke(currentColor);
           
           line(marginX + (i-1) * lineWidthIncrement - 2.0, j, marginX + (i-1) * lineWidthIncrement + 2.0, j);
         }
         strokeWeight(4.0);
         stroke(0.0);
      }
      else {
        fill(0.0);
        if(mouseX > marginX + (i-1) * lineWidthIncrement - 2.0 && mouseX < marginX + (i-1) * lineWidthIncrement + 2.0 && mouseY > topMargin && mouseY < topMargin + frameHeight) {
           strokeWeight(8); 
         }
        line(marginX + (i-1) * lineWidthIncrement, topMargin, marginX + (i-1) * lineWidthIncrement, topMargin + frameHeight);
        strokeWeight(4.0);
      }
      fill(0.0);
      
      String currentMinStr = currentMin.toString();
      if(orientations[i-1] == 0) {
        text(currentMinStr, (marginX - 0.5*textWidth(currentMinStr)) + (i-1) * lineWidthIncrement, (1.25*topMargin) + frameHeight);
      }
      if(orientations[i-1] == 1) {
        text(currentMinStr, (marginX - 0.5*textWidth(currentMaxStr)) + (i-1) * lineWidthIncrement, (0.8*topMargin));
        text(currentMaxStr, (marginX - 0.5*textWidth(currentMinStr)) + (i-1) * lineWidthIncrement, (1.25*topMargin) + frameHeight);
      }
      
      //Dimension range triangle toggles
      strokeWeight(2.0);
      fill(color(255.0,0.0,0.0));
      if(!togglesHaveChanged) {
        topKnobHeights[i-1] = 0.0;
        bottomKnobHeights[i-1] = 1.0;
      }
      topKnobHeights[i-1] = max(0.0, topKnobHeights[i-1]);
      if(togglingTop[i-1]) {
         topKnobHeights[i-1] = max(0.0,min(bottomKnobHeights[i-1], (mouseY - topMargin) / frameHeight));
      }
      bottomKnobHeights[i-1] = min(1.0, bottomKnobHeights[i-1]);
      if(togglingBottom[i-1]) {
        bottomKnobHeights[i-1] = min(1.0, max(0.0, (mouseY - topMargin) / frameHeight));  
      }
      
      triangle(marginX + (i-1) * lineWidthIncrement, topMargin + (frameHeight * topKnobHeights[i-1]), (marginX + (i-1) * lineWidthIncrement) - 10.0, (topMargin + (frameHeight * topKnobHeights[i-1])) - 7.5, (marginX + (i-1) * lineWidthIncrement) + 10.0, (topMargin + (frameHeight * topKnobHeights[i-1])) - 7.5);
      fill(color(0.0,255.0,0.0));
      triangle(marginX + (i-1) * lineWidthIncrement, topMargin + (frameHeight * bottomKnobHeights[i-1]), (marginX + (i-1) * lineWidthIncrement) - 10.0, topMargin + (bottomKnobHeights[i-1] * frameHeight) + 7.5, (marginX + (i-1) * lineWidthIncrement) + 10.0, topMargin+(bottomKnobHeights[i-1]*frameHeight) + 7.5);
      
      //Hovering over swap buttons
      if(orientations[i - 1] == 1) {
        fill(color(255.0,255.0,255.0));
      }
      else {
        fill(color(0.0,255.0,0.0));
        if(mouseX > (marginX + (i-1) * lineWidthIncrement)-(0.02*width) && mouseX < ((marginX + (i-1) * lineWidthIncrement)-(0.02*width)) + (0.04*width) && mouseY > 1.75*topMargin + frameHeight && mouseY < (1.75*topMargin + frameHeight) + 0.04*height) {
          fill(color(0.0,255.0,250.0));
        }
      }
      //swap buttons
      rect((marginX + (i-1) * lineWidthIncrement)-(0.02*width), 1.75*topMargin + frameHeight, 0.04*width, 0.04*height);    
      fill(0.0);
      text("swap",(marginX + (i-1) * lineWidthIncrement)-(0.015*width), 1.92*topMargin + frameHeight);
      
      //Gradient buttons
      if(colorSelectionModes[i - 1]) {
        fill(color(255.0,255.0,255.0));
      }
      else {
        fill(color(200.0,40.0,200.0)); 
        if(mouseX > (marginX + (i-1) * lineWidthIncrement)-(0.03*width) && mouseX < (marginX + (i-1) * lineWidthIncrement)-(0.03*width) + (0.06*width) && mouseY > 2.15*topMargin + frameHeight && mouseY < 2.15*topMargin + frameHeight + 0.04*height) {
          fill(color(255.0,110.0,180.0)); 
        }      
       }
      rect((marginX + (i-1) * lineWidthIncrement)-(0.03*width), 2.15*topMargin + frameHeight, 0.06*width, 0.04*height);
      fill(0.0);
      text("gradient",(marginX + (i-1) * lineWidthIncrement)-(0.025*width), 2.32*topMargin + frameHeight);
      fill(color(255,255,102));
      if(inTriangle((marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement) - (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height), (marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight + (0.04 * height), mouseX, mouseY) || 
         inTriangle((marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight + (0.04 * height), (marginX + (i-1) * lineWidthIncrement) + (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height), mouseX, mouseY)
      ) {
        fill(color(255,215,0));
      }
      quad((marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight, (marginX + (i-1) * lineWidthIncrement) - (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height), (marginX + (i-1) * lineWidthIncrement), (2.55*topMargin) + frameHeight + (0.04 * height), (marginX + (i-1) * lineWidthIncrement) + (0.05*width), (2.55*topMargin) + frameHeight + (0.02 * height));
      fill(0.0);
      
      text("reorder", (marginX + (i-1) * lineWidthIncrement) - (textWidth("reorder")/2.0), (2.55*topMargin) + frameHeight + (0.021 * height));
      
 }
 if(draggedIndex != -1) {
    drawColumnAtMouse(draggedIndex);
 }
 
 
}

</script>
<canvas id="mycanvas"></canvas>